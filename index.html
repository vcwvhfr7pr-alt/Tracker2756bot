<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        background: var(--tg-theme-bg-color, #ffffff);
        color: var(--tg-theme-text-color, #000000);
        padding: 10px;
        overflow-x: hidden;
        touch-action: pan-y;
    }
    
    .container {
        max-width: 100%;
        margin: 0 auto;
        padding-bottom: 20px;
    }
    
    .header {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px 10px;
        background: var(--tg-theme-secondary-bg-color, #f4f4f5);
        border-radius: 12px;
    }
    
    .header h1 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 12px;
    }
    
    .month-input {
        display: flex;
        gap: 8px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .month-input input {
        padding: 8px 12px;
        border: 1px solid var(--tg-theme-hint-color, #999);
        border-radius: 8px;
        font-size: 14px;
        background: var(--tg-theme-bg-color, #fff);
        color: var(--tg-theme-text-color, #000);
        flex: 1;
        min-width: 100px;
        max-width: 150px;
    }
    
    .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin-bottom: 20px;
    }
    
    table {
        width: 100%;
        min-width: 800px;
        border-collapse: collapse;
        font-size: 11px;
    }
    
    th, td {
        border: 1px solid var(--tg-theme-hint-color, #ccc);
        padding: 6px 3px;
        text-align: center;
    }
    
    th {
        background: var(--tg-theme-button-color, #3390ec);
        color: var(--tg-theme-button-text-color, #ffffff);
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .habit-name {
        text-align: left;
        padding-left: 8px;
        background: var(--tg-theme-secondary-bg-color, #a8a8a8);
        color: var(--tg-theme-text-color, #000);
        font-weight: 600;
        min-width: 120px;
        position: sticky;
        left: 0;
        z-index: 5;
    }
    
    .day-cell {
        width: 28px;
        height: 32px;
        cursor: pointer;
        transition: all 0.2s;
        user-select: none;
    }
    
    .day-cell:active {
        transform: scale(0.95);
    }
    
    .day-cell.checked {
        background: #4ade80;
        color: #ffffff;
        font-weight: bold;
        font-size: 14px;
    }
    
    .total-cell {
        background: var(--tg-theme-button-color, #3390ec);
        color: var(--tg-theme-button-text-color, #ffffff);
        font-weight: bold;
        position: sticky;
        right: 0;
    }
    
    .section-title {
        font-size: 18px;
        font-weight: 600;
        margin: 25px 0 12px 0;
        padding: 10px;
        background: var(--tg-theme-secondary-bg-color, #f4f4f5);
        border-radius: 8px;
    }
    
    .sleep-tracker {
        position: relative;
        height: 200px;
        background: var(--tg-theme-secondary-bg-color, #f9f9f9);
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 12px;
        overflow: hidden;
    }
    
    .sleep-grid {
        position: absolute;
        top: 15px;
        left: 60px;
        right: 15px;
        bottom: 30px;
    }
    
    .sleep-line {
        stroke: var(--tg-theme-link-color, #3390ec);
        stroke-width: 2;
        fill: none;
    }
    
    .sleep-point {
        cursor: pointer;
        transition: r 0.2s;
    }
    
    .sleep-point:active {
        r: 7;
    }
    
    .sleep-labels {
        position: absolute;
        left: 5px;
        top: 15px;
        bottom: 30px;
        width: 50px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        font-size: 10px;
    }
    
    .mood-tracker-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .mood-tracker {
        min-width: 800px;
    }
    
    .mood-tracker td {
        height: 45px;
        font-size: 22px;
        cursor: pointer;
    }
    
    .mood-tracker .day-cell:active {
        transform: scale(1.3);
    }
    
    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
        margin-top: 20px;
    }
    
    .stat-card {
        padding: 15px;
        background: var(--tg-theme-secondary-bg-color, #f4f4f5);
        border-radius: 12px;
        text-align: center;
    }
    
    .stat-card .number {
        font-size: 28px;
        font-weight: bold;
        color: var(--tg-theme-link-color, #3390ec);
    }
    
    .stat-card .label {
        font-size: 12px;
        color: var(--tg-theme-hint-color, #999);
        margin-top: 5px;
    }
    
    .button-group {
        display: flex;
        gap: 10px;
        margin: 20px 0;
    }
    
    .btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        background: var(--tg-theme-button-color, #3390ec);
        color: var(--tg-theme-button-text-color, #ffffff);
        transition: opacity 0.2s;
    }
    
    .btn:active {
        opacity: 0.7;
    }
    
    .btn-secondary {
        background: var(--tg-theme-secondary-bg-color, #e5e5e5);
        color: var(--tg-theme-text-color, #000);
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</h1>
            <div class="month-input">
                <input type="text" id="monthInput" placeholder="–ú–µ—Å—è—Ü" value="–Ø–Ω–≤–∞—Ä—å">
                <input type="number" id="yearInput" placeholder="–ì–æ–¥" value="2025" min="2020" max="2030">
            </div>
            <div class="month-input" style="margin-top: 10px;">
                <input type="text" id="chapterInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã" value="–ú–æ—è —Ü–µ–ª—å" style="max-width: 100%;">
            </div>
        </div>

```
    <div class="section-title">üìÖ 30 –¥–Ω–µ–π –ø—Ä–∏–≤—ã—á–µ–∫</div>
    <div class="table-container">
        <table id="habitsTable">
            <thead>
                <tr>
                    <th>–ü—Ä–∏–≤—ã—á–∫–∏</th>
                    <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th>
                    <th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th>
                    <th>21</th><th>22</th><th>23</th><th>24</th><th>25</th><th>26</th><th>27</th><th>28</th><th>29</th><th>30</th>
                    <th>–í—Å–µ–≥–æ</th>
                </tr>
            </thead>
            <tbody id="habitsBody">
            </tbody>
        </table>
    </div>
    
    <div class="section-title">üò¥ –¢—Ä–µ–∫–µ—Ä —Å–Ω–∞</div>
    <div class="sleep-tracker">
        <div class="sleep-labels">
            <div>8+ —á</div>
            <div>7 —á</div>
            <div>6 —á</div>
            <div>5 —á</div>
            <div>4 —á</div>
            <div>3 —á</div>
        </div>
        <svg id="sleepChart" class="sleep-grid" width="100%" height="100%"></svg>
    </div>
    
    <div class="section-title">üòä –¢—Ä–µ–∫–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</div>
    <div class="mood-tracker-container">
        <table class="mood-tracker">
            <thead>
                <tr>
                    <th>–î–Ω–∏</th>
                    <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th>
                    <th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th>
                    <th>21</th><th>22</th><th>23</th><th>24</th><th>25</th><th>26</th><th>27</th><th>28</th><th>29</th><th>30</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="habit-name">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</td>
                    <td class="day-cell mood-cell" data-day="1">üòä</td>
                    <td class="day-cell mood-cell" data-day="2">üòä</td>
                    <td class="day-cell mood-cell" data-day="3">üòä</td>
                    <td class="day-cell mood-cell" data-day="4">üòä</td>
                    <td class="day-cell mood-cell" data-day="5">üòä</td>
                    <td class="day-cell mood-cell" data-day="6">üòä</td>
                    <td class="day-cell mood-cell" data-day="7">üòä</td>
                    <td class="day-cell mood-cell" data-day="8">üòä</td>
                    <td class="day-cell mood-cell" data-day="9">üòä</td>
                    <td class="day-cell mood-cell" data-day="10">üòä</td>
                    <td class="day-cell mood-cell" data-day="11">üòä</td>
                    <td class="day-cell mood-cell" data-day="12">üòä</td>
                    <td class="day-cell mood-cell" data-day="13">üòä</td>
                    <td class="day-cell mood-cell" data-day="14">üòä</td>
                    <td class="day-cell mood-cell" data-day="15">üòä</td>
                    <td class="day-cell mood-cell" data-day="16">üòä</td>
                    <td class="day-cell mood-cell" data-day="17">üòä</td>
                    <td class="day-cell mood-cell" data-day="18">üòä</td>
                    <td class="day-cell mood-cell" data-day="19">üòä</td>
                    <td class="day-cell mood-cell" data-day="20">üòä</td>
                    <td class="day-cell mood-cell" data-day="21">üòä</td>
                    <td class="day-cell mood-cell" data-day="22">üòä</td>
                    <td class="day-cell mood-cell" data-day="23">üòä</td>
                    <td class="day-cell mood-cell" data-day="24">üòä</td>
                    <td class="day-cell mood-cell" data-day="25">üòä</td>
                    <td class="day-cell mood-cell" data-day="26">üòä</td>
                    <td class="day-cell mood-cell" data-day="27">üòä</td>
                    <td class="day-cell mood-cell" data-day="28">üòä</td>
                    <td class="day-cell mood-cell" data-day="29">üòä</td>
                    <td class="day-cell mood-cell" data-day="30">üòä</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="section-title">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
    <div class="stats">
        <div class="stat-card">
            <div class="number" id="totalChecks">0</div>
            <div class="label">–û—Ç–º–µ—Ç–æ–∫</div>
        </div>
        <div class="stat-card">
            <div class="number" id="avgSleep">0</div>
            <div class="label">–°—Ä–µ–¥–Ω–∏–π —Å–æ–Ω</div>
        </div>
        <div class="stat-card">
            <div class="number" id="completion">0%</div>
            <div class="label">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
        </div>
    </div>
    
    <div class="button-group">
        <button class="btn btn-secondary" onclick="resetData()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
        <button class="btn" onclick="exportData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
    </div>
</div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram
    document.body.style.backgroundColor = tg.backgroundColor || '#ffffff';
    
    const defaultHabits = [
        'üö´ –ë–µ–∑ –∫–æ—Ñ–µ',
        'üí™ –ó–∞–ª',
        'üíß –ü–∏—Ç—å –≤–æ–¥—É',
        'ü•ó –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ',
        'üìö –ò–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞',
        'üôè –ú–æ–ª–∏—Ç–≤–∞',
        'üßò –ü–æ–∑–∞ –ó–û–ñ',
        '‚ú® –ü–æ–ª–µ–∑–Ω–∞—è –ø—Ä–∏–≤—ã—á–∫–∞',
        'üì± –≠–∫—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è -5',
        'üìù –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞'
    ];
    
    const storageKey = `habit_tracker_${tg.initDataUnsafe?.user?.id || 'default'}`;
    
    function loadData() {
        const data = localStorage.getItem(storageKey);
        return data ? JSON.parse(data) : {
            habits: defaultHabits,
            habitData: {},
            sleepData: {},
            moodData: {}
        };
    }
    
    function saveData() {
        const data = {
            habits,
            habitData,
            sleepData,
            moodData
        };
        localStorage.setItem(storageKey, JSON.stringify(data));
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
        tg.showAlert('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    }
    
    const savedData = loadData();
    const habits = savedData.habits;
    const habitData = savedData.habitData;
    const sleepData = savedData.sleepData;
    const moodData = savedData.moodData;
    
    const moods = ['üòä', 'üòê', 'üò¢', 'üò¥', 'üòé', 'ü§î', 'üò§', 'ü•≥', 'üòá', 'ü§ó'];
    
    function initHabits() {
        const tbody = document.getElementById('habitsBody');
        tbody.innerHTML = '';
        
        habits.forEach((habit, habitIndex) => {
            const row = document.createElement('tr');
            
            const nameCell = document.createElement('td');
            nameCell.className = 'habit-name';
            nameCell.textContent = habit;
            nameCell.addEventListener('click', function() {
                const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏:', habit);
                if (newName && newName.trim()) {
                    habits[habitIndex] = newName.trim();
                    this.textContent = newName.trim();
                    saveData();
                }
            });
            row.appendChild(nameCell);
            
            for (let day = 1; day <= 30; day++) {
                const cell = document.createElement('td');
                cell.className = 'day-cell';
                const key = `${habitIndex}-${day}`;
                if (habitData[key]) {
                    cell.textContent = '‚úì';
                    cell.classList.add('checked');
                }
                cell.addEventListener('click', function() {
                    this.classList.toggle('checked');
                    if (this.classList.contains('checked')) {
                        this.textContent = '‚úì';
                        habitData[key] = true;
                        tg.HapticFeedback.impactOccurred('light');
                    } else {
                        this.textContent = '';
                        delete habitData[key];
                    }
                    saveData();
                    updateTotals();
                    updateStats();
                });
                row.appendChild(cell);
            }
            
            const totalCell = document.createElement('td');
            totalCell.className = 'total-cell';
            totalCell.id = `total-${habitIndex}`;
            row.appendChild(totalCell);
            
            tbody.appendChild(row);
        });
        
        updateTotals();
    }
    
    function updateTotals() {
        habits.forEach((_, habitIndex) => {
            let total = 0;
            for (let day = 1; day <= 30; day++) {
                if (habitData[`${habitIndex}-${day}`]) total++;
            }
            const totalCell = document.getElementById(`total-${habitIndex}`);
            if (totalCell) totalCell.textContent = total;
        });
    }
    
    function initSleepTracker() {
        const svg = document.getElementById('sleepChart');
        const width = svg.clientWidth;
        const height = svg.clientHeight;
        
        svg.innerHTML = '';
        
        for (let i = 0; i <= 5; i++) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            const y = (height / 5) * i;
            line.setAttribute('x1', '0');
            line.setAttribute('y1', y);
            line.setAttribute('x2', width);
            line.setAttribute('y2', y);
            line.setAttribute('stroke', tg.themeParams.hint_color || '#ddd');
            svg.appendChild(line);
        }
        
        for (let i = 0; i <= 30; i++) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            const x = (width / 30) * i;
            line.setAttribute('x1', x);
            line.setAttribute('y1', '0');
            line.setAttribute('x2', x);
            line.setAttribute('y2', height);
            line.setAttribute('stroke', tg.themeParams.hint_color || '#ddd');
            svg.appendChild(line);
        }
        
        const polyline = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
        polyline.setAttribute('class', 'sleep-line');
        
        let points = '';
        for (let day = 1; day <= 30; day++) {
            const x = ((day - 0.5) / 30) * width;
            const hours = sleepData[day] || 7;
            const y = height - ((hours - 3) / 5) * height;
            points += `${x},${y} `;
            
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('class', 'sleep-point');
            circle.setAttribute('cx', x);
            circle.setAttribute('cy', y);
            circle.setAttribute('r', '4');
            circle.setAttribute('fill', tg.themeParams.link_color || '#3390ec');
            circle.setAttribute('data-day', day);
            
            circle.addEventListener('click', function() {
                const day = parseInt(this.getAttribute('data-day'));
                const newHours = prompt(`–î–µ–Ω—å ${day}: –≤–≤–µ–¥–∏—Ç–µ —á–∞—Å—ã —Å–Ω–∞ (3-8):`, sleepData[day] || 7);
                if (newHours && !isNaN(newHours)) {
                    const hours = Math.max(3, Math.min(8, parseFloat(newHours)));
                    sleepData[day] = hours;
                    tg.HapticFeedback.impactOccurred('medium');
                    saveData();
                    initSleepTracker();
                    updateStats();
                }
            });
            
            svg.appendChild(circle);
        }
        
        polyline.setAttribute('points', points.trim());
        svg.insertBefore(polyline, svg.firstChild);
    }
    
    function initMoodTracker() {
        document.querySelectorAll('.mood-cell').forEach(cell => {
            const day = parseInt(cell.getAttribute('data-day'));
            if (moodData[day] !== undefined) {
                cell.textContent = moods[moodData[day]];
            }
            
            cell.addEventListener('click', function() {
                const day = parseInt(this.getAttribute('data-day'));
                const currentIndex = moodData[day] !== undefined ? moodData[day] : 0;
                const newIndex = (currentIndex + 1) % moods.length;
                this.textContent = moods[newIndex];
                moodData[day] = newIndex;
                tg.HapticFeedback.impactOccurred('light');
                saveData();
            });
        });
    }
    
    function updateStats() {
        const totalChecks = Object.keys(habitData).length;
        document.getElementById('totalChecks').textContent = totalChecks;
        
        const sleepValues = Object.values(sleepData);
        const avgSleep = sleepValues.length > 0 
            ? (sleepValues.reduce((a, b) => a + b, 0) / sleepValues.length).toFixed(1)
            : 0;
        document.getElementById('avgSleep').textContent = avgSleep;
        
        const totalPossible = habits.length * 30;
        const completion = totalPossible > 0 ? Math.round((totalChecks / totalPossible) * 100) : 0;
        document.getElementById('completion').textContent = completion + '%';
    }
    
    function resetData() {
        if (confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
            localStorage.removeItem(storageKey);
            location.reload();
        }
    }
    
    function exportData() {
        const data = loadData();
        const text = JSON.stringify(data, null, 2);
        const blob = new Blob([text], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `habit_tracker_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        tg.showAlert('üì• –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    initHabits();
    initSleepTracker();
    initMoodTracker();
    updateStats();
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener('resize', () => {
        initSleepTracker();
    });
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    setTimeout(() => {
        tg.showPopup({
            title: 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
            message: '–ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ —è—á–µ–π–∫–∏ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.',
            buttons: [{type: 'ok'}]
        });
    }, 1000);
</script>
```

</body>
</html>
