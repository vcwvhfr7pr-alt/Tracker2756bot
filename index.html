<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        background: var(--tg-theme-bg-color, #000000);
        color: var(--tg-theme-text-color, #ffffff);
        overflow: hidden;
        height: 100vh;
        touch-action: pan-x pan-y;
    }
    
    .app-container {
        display: flex;
        height: 100vh;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
    }
    
    .page {
        min-width: 100vw;
        height: 100vh;
        scroll-snap-align: start;
        overflow-y: auto;
        padding: 15px;
        padding-bottom: 80px;
    }
    
    .header {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px;
        background: var(--tg-theme-secondary-bg-color, #1c1c1e);
        border-radius: 12px;
    }
    
    .header h1 {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .header-subtitle {
        font-size: 14px;
        color: var(--tg-theme-hint-color, #8e8e93);
    }
    
    .month-input {
        display: flex;
        gap: 8px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 12px;
    }
    
    .month-input input {
        padding: 10px 12px;
        border: 1px solid var(--tg-theme-hint-color, #3a3a3c);
        border-radius: 8px;
        font-size: 14px;
        background: var(--tg-theme-secondary-bg-color, #1c1c1e);
        color: var(--tg-theme-text-color, #ffffff);
        flex: 1;
        min-width: 100px;
        max-width: 150px;
    }
    
    .habit-item {
        background: var(--tg-theme-secondary-bg-color, #1c1c1e);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 12px;
    }
    
    .habit-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    
    .habit-name {
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        flex: 1;
    }
    
    .habit-counter {
        background: var(--tg-theme-button-color, #0088cc);
        color: var(--tg-theme-button-text-color, #ffffff);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        min-width: 50px;
        text-align: center;
    }
    
    .days-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
    }
    
    .day-btn {
        aspect-ratio: 1;
        border: 2px solid var(--tg-theme-hint-color, #3a3a3c);
        border-radius: 12px;
        background: transparent;
        color: var(--tg-theme-text-color, #ffffff);
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 60px;
        position: relative;
    }
    
    .day-btn:active {
        transform: scale(0.92);
    }
    
    .day-btn.checked {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
        color: #ffffff;
    }
    
    .day-btn.checked::after {
        content: '‚úì';
        position: absolute;
        font-size: 24px;
    }
    
    .sleep-page {
        padding-top: 80px;
    }
    
    .sleep-day-item {
        background: var(--tg-theme-secondary-bg-color, #1c1c1e);
        border-radius: 12px;
        padding: 15px 20px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .sleep-day-item:active {
        transform: scale(0.98);
    }
    
    .sleep-day-label {
        font-size: 16px;
        font-weight: 600;
    }
    
    .sleep-hours {
        display: flex;
        gap: 8px;
        align-items: center;
    }
    
    .sleep-btn {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 50%;
        background: var(--tg-theme-button-color, #0088cc);
        color: var(--tg-theme-button-text-color, #ffffff);
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .sleep-btn:active {
        transform: scale(0.9);
    }
    
    .sleep-value {
        font-size: 24px;
        font-weight: 700;
        min-width: 60px;
        text-align: center;
        color: var(--tg-theme-link-color, #0088cc);
    }
    
    .mood-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .mood-day-item {
        background: var(--tg-theme-secondary-bg-color, #1c1c1e);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .mood-day-item:active {
        transform: scale(0.95);
    }
    
    .mood-day-label {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--tg-theme-hint-color, #8e8e93);
    }
    
    .mood-emoji {
        font-size: 48px;
        margin-bottom: 8px;
    }
    
    .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
    }
    
    .stat-card {
        padding: 20px 15px;
        background: var(--tg-theme-secondary-bg-color, #1c1c1e);
        border-radius: 12px;
        text-align: center;
    }
    
    .stat-card .number {
        font-size: 28px;
        font-weight: bold;
        color: var(--tg-theme-link-color, #0088cc);
        margin-bottom: 5px;
    }
    
    .stat-card .label {
        font-size: 11px;
        color: var(--tg-theme-hint-color, #8e8e93);
    }
    
    .page-indicator {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 100;
        background: var(--tg-theme-secondary-bg-color, rgba(28, 28, 30, 0.8));
        padding: 10px 20px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
    }
    
    .page-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--tg-theme-hint-color, #3a3a3c);
        transition: all 0.3s;
    }
    
    .page-dot.active {
        background: var(--tg-theme-link-color, #0088cc);
        width: 24px;
        border-radius: 4px;
    }
    
    .section-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--tg-theme-text-color, #ffffff);
    }
    
    .add-habit-btn {
        width: 100%;
        padding: 15px;
        border: 2px dashed var(--tg-theme-hint-color, #3a3a3c);
        border-radius: 12px;
        background: transparent;
        color: var(--tg-theme-hint-color, #8e8e93);
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 12px;
        transition: all 0.2s;
    }
    
    .add-habit-btn:active {
        transform: scale(0.98);
        border-color: var(--tg-theme-link-color, #0088cc);
        color: var(--tg-theme-link-color, #0088cc);
    }
    
    .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    
    .btn {
        flex: 1;
        padding: 15px;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        background: var(--tg-theme-button-color, #0088cc);
        color: var(--tg-theme-button-text-color, #ffffff);
        transition: opacity 0.2s;
    }
    
    .btn:active {
        opacity: 0.7;
    }
    
    .btn-secondary {
        background: var(--tg-theme-secondary-bg-color, #1c1c1e);
        color: var(--tg-theme-text-color, #ffffff);
    }
    
    .scroll-hint {
        text-align: center;
        padding: 10px;
        color: var(--tg-theme-hint-color, #8e8e93);
        font-size: 12px;
        margin-top: 10px;
    }
</style>
```

</head>
<body>
    <div class="app-container" id="appContainer">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –ü—Ä–∏–≤—ã—á–∫–∏ -->
        <div class="page" id="page1">
            <div class="header">
                <h1>üìä –¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</h1>
                <div class="header-subtitle">–°–≤–∞–π–ø–Ω–∏—Ç–µ –≤–ª–µ–≤–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ ‚Üí</div>
                <div class="month-input">
                    <input type="text" id="monthInput" placeholder="–ú–µ—Å—è—Ü" value="–Ø–Ω–≤–∞—Ä—å">
                    <input type="number" id="yearInput" placeholder="–ì–æ–¥" value="2025">
                </div>
            </div>

```
        <div class="section-title">–ú–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏</div>
        <div id="habitsContainer"></div>
        <button class="add-habit-btn" onclick="addNewHabit()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</button>
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –°–æ–Ω -->
    <div class="page" id="page2">
        <div class="header">
            <h1>üò¥ –¢—Ä–µ–∫–µ—Ä —Å–Ω–∞</h1>
            <div class="header-subtitle">–ù–∞–∂–º–∏—Ç–µ +/- –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∞—Å–æ–≤ —Å–Ω–∞</div>
        </div>
        
        <div class="section-title">30 –¥–Ω–µ–π —Å–Ω–∞</div>
        <div id="sleepContainer"></div>
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="page" id="page3">
        <div class="header">
            <h1>üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</h1>
            <div class="header-subtitle">–ö–∞–∫ –ø—Ä–æ—à—ë–ª –≤–∞—à –¥–µ–Ω—å?</div>
        </div>
        
        <div class="section-title">30 –¥–Ω–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</div>
        <div class="mood-grid" id="moodContainer"></div>
        
        <div class="section-title" style="margin-top: 30px;">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div class="stats">
            <div class="stat-card">
                <div class="number" id="totalChecks">0</div>
                <div class="label">–û—Ç–º–µ—Ç–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="number" id="avgSleep">0</div>
                <div class="label">–°—Ä–µ–¥–Ω–∏–π —Å–æ–Ω</div>
            </div>
            <div class="stat-card">
                <div class="number" id="completion">0%</div>
                <div class="label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn btn-secondary" onclick="resetData()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
            <button class="btn" onclick="exportData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
    </div>
</div>

<div class="page-indicator">
    <div class="page-dot active" data-page="0"></div>
    <div class="page-dot" data-page="1"></div>
    <div class="page-dot" data-page="2"></div>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();
    
    const defaultHabits = [
        'üö´ –ë–µ–∑ –∫–æ—Ñ–µ',
        'üí™ –ó–∞–ª',
        'üíß –ü–∏—Ç—å –≤–æ–¥—É',
        'ü•ó –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ',
        'üìö –ò–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞',
        'üôè –ú–æ–ª–∏—Ç–≤–∞',
        'üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è',
        'üìù –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞'
    ];
    
    const moods = ['üòä', 'üòê', 'üò¢', 'üò¥', 'üòé', 'ü§î', 'üò§', 'ü•≥', 'üòá', 'ü§ó'];
    const storageKey = `habit_tracker_${tg.initDataUnsafe?.user?.id || 'default'}`;
    
    function loadData() {
        const data = localStorage.getItem(storageKey);
        return data ? JSON.parse(data) : {
            habits: defaultHabits,
            habitData: {},
            sleepData: {},
            moodData: {}
        };
    }
    
    function saveData() {
        const data = { habits, habitData, sleepData, moodData };
        localStorage.setItem(storageKey, JSON.stringify(data));
    }
    
    const savedData = loadData();
    const habits = savedData.habits;
    const habitData = savedData.habitData;
    const sleepData = savedData.sleepData;
    const moodData = savedData.moodData;
    
    function initHabits() {
        const container = document.getElementById('habitsContainer');
        container.innerHTML = '';
        
        habits.forEach((habit, habitIndex) => {
            const habitItem = document.createElement('div');
            habitItem.className = 'habit-item';
            
            const header = document.createElement('div');
            header.className = 'habit-header';
            
            const name = document.createElement('div');
            name.className = 'habit-name';
            name.textContent = habit;
            name.onclick = () => {
                const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', habit);
                if (newName && newName.trim()) {
                    habits[habitIndex] = newName.trim();
                    saveData();
                    initHabits();
                }
            };
            
            const counter = document.createElement('div');
            counter.className = 'habit-counter';
            counter.id = `counter-${habitIndex}`;
            
            header.appendChild(name);
            header.appendChild(counter);
            
            const grid = document.createElement('div');
            grid.className = 'days-grid';
            
            for (let day = 1; day <= 30; day++) {
                const btn = document.createElement('button');
                btn.className = 'day-btn';
                btn.textContent = day;
                
                const key = `${habitIndex}-${day}`;
                if (habitData[key]) {
                    btn.classList.add('checked');
                }
                
                btn.onclick = () => {
                    btn.classList.toggle('checked');
                    if (btn.classList.contains('checked')) {
                        habitData[key] = true;
                        tg.HapticFeedback.impactOccurred('light');
                    } else {
                        delete habitData[key];
                    }
                    saveData();
                    updateCounters();
                    updateStats();
                };
                
                grid.appendChild(btn);
            }
            
            habitItem.appendChild(header);
            habitItem.appendChild(grid);
            container.appendChild(habitItem);
        });
        
        updateCounters();
    }
    
    function updateCounters() {
        habits.forEach((_, habitIndex) => {
            let total = 0;
            for (let day = 1; day <= 30; day++) {
                if (habitData[`${habitIndex}-${day}`]) total++;
            }
            const counter = document.getElementById(`counter-${habitIndex}`);
            if (counter) counter.textContent = `${total}/30`;
        });
    }
    
    function initSleep() {
        const container = document.getElementById('sleepContainer');
        container.innerHTML = '';
        
        for (let day = 1; day <= 30; day++) {
            const item = document.createElement('div');
            item.className = 'sleep-day-item';
            
            const label = document.createElement('div');
            label.className = 'sleep-day-label';
            label.textContent = `–î–µ–Ω—å ${day}`;
            
            const hours = document.createElement('div');
            hours.className = 'sleep-hours';
            
            const minusBtn = document.createElement('button');
            minusBtn.className = 'sleep-btn';
            minusBtn.textContent = '‚àí';
            minusBtn.onclick = () => {
                const current = sleepData[day] || 7;
                if (current > 0) {
                    sleepData[day] = Math.max(0, current - 0.5);
                    tg.HapticFeedback.impactOccurred('light');
                    saveData();
                    updateSleepValue(day);
                    updateStats();
                }
            };
            
            const value = document.createElement('div');
            value.className = 'sleep-value';
            value.id = `sleep-${day}`;
            value.textContent = `${sleepData[day] || 7}—á`;
            
            const plusBtn = document.createElement('button');
            plusBtn.className = 'sleep-btn';
            plusBtn.textContent = '+';
            plusBtn.onclick = () => {
                const current = sleepData[day] || 7;
                if (current < 12) {
                    sleepData[day] = Math.min(12, current + 0.5);
                    tg.HapticFeedback.impactOccurred('light');
                    saveData();
                    updateSleepValue(day);
                    updateStats();
                }
            };
            
            hours.appendChild(minusBtn);
            hours.appendChild(value);
            hours.appendChild(plusBtn);
            
            item.appendChild(label);
            item.appendChild(hours);
            container.appendChild(item);
        }
    }
    
    function updateSleepValue(day) {
        const value = document.getElementById(`sleep-${day}`);
        if (value) {
            value.textContent = `${sleepData[day] || 7}—á`;
        }
    }
    
    function initMood() {
        const container = document.getElementById('moodContainer');
        container.innerHTML = '';
        
        for (let day = 1; day <= 30; day++) {
            const item = document.createElement('div');
            item.className = 'mood-day-item';
            
            const label = document.createElement('div');
            label.className = 'mood-day-label';
            label.textContent = `–î–µ–Ω—å ${day}`;
            
            const emoji = document.createElement('div');
            emoji.className = 'mood-emoji';
            emoji.id = `mood-${day}`;
            const currentMood = moodData[day] !== undefined ? moodData[day] : 0;
            emoji.textContent = moods[currentMood];
            
            item.onclick = () => {
                const current = moodData[day] !== undefined ? moodData[day] : 0;
                const next = (current + 1) % moods.length;
                moodData[day] = next;
                emoji.textContent = moods[next];
                tg.HapticFeedback.impactOccurred('light');
                saveData();
            };
            
            item.appendChild(label);
            item.appendChild(emoji);
            container.appendChild(item);
        }
    }
    
    function updateStats() {
        const totalChecks = Object.keys(habitData).length;
        document.getElementById('totalChecks').textContent = totalChecks;
        
        const sleepValues = Object.values(sleepData);
        const avgSleep = sleepValues.length > 0 
            ? (sleepValues.reduce((a, b) => a + b, 0) / sleepValues.length).toFixed(1)
            : 7;
        document.getElementById('avgSleep').textContent = avgSleep + '—á';
        
        const totalPossible = habits.length * 30;
        const completion = totalPossible > 0 ? Math.round((totalChecks / totalPossible) * 100) : 0;
        document.getElementById('completion').textContent = completion + '%';
    }
    
    function addNewHabit() {
        const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏:');
        if (name && name.trim()) {
            habits.push(name.trim());
            saveData();
            initHabits();
            tg.HapticFeedback.notificationOccurred('success');
        }
    }
    
    function resetData() {
        if (confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
            localStorage.removeItem(storageKey);
            location.reload();
        }
    }
    
    function exportData() {
        const data = loadData();
        const text = JSON.stringify(data, null, 2);
        const blob = new Blob([text], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `habit_tracker_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        tg.showAlert('üì• –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
    }
    
    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü
    const container = document.getElementById('appContainer');
    const dots = document.querySelectorAll('.page-dot');
    
    container.addEventListener('scroll', () => {
        const scrollLeft = container.scrollLeft;
        const pageWidth = container.clientWidth;
        const currentPage = Math.round(scrollLeft / pageWidth);
        
        dots.forEach((dot, index) => {
            if (index === currentPage) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    });
    
    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            container.scrollTo({
                left: index * container.clientWidth,
                behavior: 'smooth'
            });
        });
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    initHabits();
    initSleep();
    initMood();
    updateStats();
    
    setTimeout(() => {
        tg.showPopup({
            title: 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
            message: '–°–≤–∞–π–ø–∞–π—Ç–µ –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏. –ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –±–æ–ª—å—à–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –¥–Ω–µ–π!',
            buttons: [{type: 'ok'}]
        });
    }, 1000);
</script>
```

</body>
</html>
